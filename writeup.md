# **Traffic Sign Recognition** 

## Writeup

### You can use this file as a template for your writeup if you want to submit it as a markdown file, but feel free to use some other method and submit a pdf if you prefer.

---

**Build a Traffic Sign Recognition Project**

The goals / steps of this project are the following:
* Load the data set (see below for links to the project data set)
* Explore, summarize and visualize the data set
* Design, train and test a model architecture
* Use the model to make predictions on new images
* Analyze the softmax probabilities of the new images
* Summarize the results with a written report

[//]: ## HTML Page
[Model Exported to HTML]: ./Traffic_Sign_Classifier.html

[//]: ## Rotated Data
[Rotated Image]: ./other_images/rotation_example.JPG

[//]: ## Own Image Data used from internet
[70_kmph]:       ./from_internet/04_traffic_sign_70_kmph_32x32.jpeg
[right_of_way]:  ./from_internet/11_traffic_sign_right_of_way_32x32.jpeg
[priority]:      ./from_internet/12_traffic_sign_priority_32x32.jpeg
[stop]:          ./from_internet/14_traffic_sign_stop_32x32.jpeg
[road_work]:     ./from_internet/25_traffic_sign_road_work_32x32.jpeg

## Rubric Points
### Here I will consider the [rubric points](https://review.udacity.com/#!/rubrics/481/view) individually and describe how I addressed each point in my implementation.  


### Data Set Summary & Exploration

#### Here I used numpy library to find out the data set summary. It is given below:

* Number of training examples = 34799
* Number of validation examples= 4410
* Number of testing examples = 12630
* Image data shape = 32 x 32
* Number of classes = 43

#### 2. Include an exploratory visualization of the dataset.

A histogram of classes of training data, validation data and test data are shown in a form matlab plots

[Histogram_training_data]:   ./other_images/histogram_training_data.JPG
[Histogram_validation_data]: ./other_images/histogram_validation_data.JPG
[Histogram_test_data]:       ./other_images/histogram_test_data.JPG

### Design and Test a Model Architecture

#### 1. Preprocessing Steps

1st step - The training data set is extended by creating additional images which are rotated at 5, -5, 10, -10 angles. This is done only for training data set

Number of training data after preprocessing = 34799 * 5 = 173995 

Justification: The images captured in the self driving car cameras wont always be aligned vertically, there always will be some rotation factor depending on the car position in the road, road surface inclination, camera position etc. To account for these variations, new data is generated by rotating the training data by predefined angles (ie., 5, -5, 10, -10). Moreover, the more the training dataset size and its variation, more the performance of the model

2nd step - The pixel values is normalized by (pixel - 128)/ 128

Justification: Pixel values are in range (0-255). Normalization of pixel values is done to map the values to -1 to 1 range. This range has zero mean and help in making the model computationally more efficient.

3rd step - Shuffle the data

Justification: Usually the dataset will have the data arranged for each classes sequentially. We shuffle it to make the model unbiased of the sequential nature of the data set.

#### 2. Convolution neural network layers

The model is extension of LeNet model with some modifications.
My final model consisted of the following layers:

| Layer         		|     Description	        					| 
|:---------------------:|:---------------------------------------------:| 
| Input         		| 32x32x3 RGB image   							| 
| Convolution 5x5     	| 1x1 stride, valid padding, outputs 28x28x6 	|
| RELU					|												|
| Max pooling	      	| 2x2 kernel, 2x2 stride,    outputs 14x14x6    |
| Convolution 5x5	    | 1x1 stride, valid padding, outputs 10x10x16   |
| RELU					|												|
| DROP OUT				| Keep Prob = 0.75							    |
| Max pooling	      	| 2x2 kernel, 2x2 stride,    outputs 5x5x16 	|
| FLATTEN				| Outputs 400	        						|
| Fully connected		| Outputs 120       							|
| RELU					|												|
| Fully connected		| Outputs 84       								|
| RELU					|												|
| Fully connected		| Outputs 43  (Final output - Number of classes)|
| Softmax				| To convert logits to probabilities  			|
|						|												|
|						|												|
 


#### 3. Training the Model

For training the model, the logits are converted to probabilities and then cross entropy is calculated using the tf.nn.softmax_cross_entropy_with_logits method. The mean is considered to be the loss value. The training process is optimized to minimize the loss value using adam optimizer.

Hyperparameters used:
EPOCHS = 10
BATCH_SIZE = 128
Learning Rate = 0.002

#### 4. Approach

1) The LeNet framework was taken as the base network to start with. Basic analysis of German traffic sign leads to the conclusion that color information is important to classify them. Hence the LeNet is upgraded to include all 3 RGB channels of the image.

2) Running the above model results in validation accuracy of approximately 0.90 which is well below the target of 0.93. Hence increased the training data set size by creating additional images which are rotated 5, -5, 10, -10 degrees.

3) Training the model with increased training data set improved the validation accuracy to 0.92 but noticed that training accuracy is reaching 0.98 very faster (ie., model starts overfitting in the earlier epochs itself). 

4) To avoid overfitting, a dropout layer with keep_prob = 0.75 after convolution layer 2 is introduced and increased the learning rate to 0.02. The method allows to achieve desired validation accuracy 0.95 at the end of 10 epochs.

Final model results are:
* training set accuracy of 0.998
* validation set accuracy of 0.956
* test set accuracy of 0.935

### Test a Model on New Images

#### 1. The traffic signs choosen are given below:

The original images obtained from internet are available below:
[Original]:      ./from_internet/original

The dataset is a combination of some clear images and some challenging images. It is explained as below

[right_of_way]:  ./from_internet/original/traffic_sign_right_of_way.jpeg
Difficulty: Low

[road_work]:     ./from_internet/original/traffic_sign_road_work.jpeg
Difficulty: High
Reason: Scratch marks on the sign board and the sign board holders at the top and the bottom

[priority]:      ./from_internet/original/traffic_sign_priority.jpeg
Difficulty: Medium
Reason: The background is dense with lot of greenary and poles in it

[70_kmph]:       ./from_internet/original/traffic_sign_70_kmph.jpeg
Difficulty: Medium
Reason: The combination green background and the clear sky

[stop]:          ./from_internet/original/traffic_sign_stop.jpeg
Difficulty: Low

The original images are resized to 32x32 as per the input requirement:
[right_of_way]:  ./from_internet/11_traffic_sign_right_of_way_32x32.jpeg
[road_work]:     ./from_internet/25_traffic_sign_road_work_32x32.jpeg
[priority]:      ./from_internet/12_traffic_sign_priority_32x32.jpeg
[70_kmph]:       ./from_internet/04_traffic_sign_70_kmph_32x32.jpeg
[stop]:          ./from_internet/14_traffic_sign_stop_32x32.jpeg


#### 2. Prediction 

IMAGE : 11_traffic_sign_right_of_way_32x32.jpeg 
ACTUAL: Right-of-way at the next intersection 
PREDIC: Right-of-way at the next intersection


IMAGE : 25_traffic_sign_road_work_32x32.jpeg 
ACTUAL: Road work 
PREDIC: Road work


IMAGE : 12_traffic_sign_priority_32x32.jpeg 
ACTUAL: Priority road 
PREDIC: Priority road


IMAGE : 04_traffic_sign_70_kmph_32x32.jpeg 
ACTUAL: Speed limit (70km/h) 
PREDIC: Speed limit (70km/h)


IMAGE : 14_traffic_sign_stop_32x32.jpeg 
ACTUAL: Stop 
PREDIC: Stop

The model was able to correctly all 5 of the 5 traffic signs, which gives an accuracy of 100%. 

#### 3. Top 5 Softmax Probabilities of the above images

IMAGE : 11_traffic_sign_right_of_way_32x32.jpeg 
ACTUAL: Right-of-way at the next intersection
Top 0 PRED: Right-of-way at the next intersection              PROB: 1.0
Top 1 PRED: Pedestrians                                        PROB: 1.985719e-09
Top 2 PRED: Beware of ice/snow                                 PROB: 1.787224e-11
Top 3 PRED: Children crossing                                  PROB: 2.966064e-12
Top 4 PRED: General caution                                    PROB: 9.753006e-13

IMAGE : 25_traffic_sign_road_work_32x32.jpeg 
ACTUAL: Road work
Top 0 PRED: Road work                                          PROB: 0.999977
Top 1 PRED: Road narrows on the right                          PROB: 2.043404e-05
Top 2 PRED: Bumpy road                                         PROB: 2.085666e-06
Top 3 PRED: Beware of ice/snow                                 PROB: 3.633657e-07
Top 4 PRED: Wild animals crossing                              PROB: 2.17209e-08

IMAGE : 12_traffic_sign_priority_32x32.jpeg 
ACTUAL: Priority road
Top 0 PRED: Priority road                                      PROB: 1.0
Top 1 PRED: End of speed limit (80km/h)                        PROB: 1.373234e-24
Top 2 PRED: Speed limit (80km/h)                               PROB: 3.947514e-28
Top 3 PRED: Right-of-way at the next intersection              PROB: 1.833187e-30
Top 4 PRED: End of no passing                                  PROB: 4.480283e-32

IMAGE : 04_traffic_sign_70_kmph_32x32.jpeg 
ACTUAL: Speed limit (70km/h)
Top 0 PRED: Speed limit (70km/h)                               PROB: 1.0
Top 1 PRED: Speed limit (30km/h)                               PROB: 3.250676e-16
Top 2 PRED: Speed limit (50km/h)                               PROB: 3.653585e-20
Top 3 PRED: Speed limit (80km/h)                               PROB: 5.809639e-21
Top 4 PRED: Speed limit (20km/h)                               PROB: 5.137306e-21

IMAGE : 14_traffic_sign_stop_32x32.jpeg 
ACTUAL: Stop
Top 0 PRED: Stop                                               PROB: 1.0
Top 1 PRED: No entry                                           PROB: 1.207321e-23
Top 2 PRED: Speed limit (80km/h)                               PROB: 1.294056e-24
Top 3 PRED: Speed limit (60km/h)                               PROB: 4.041233e-29
Top 4 PRED: Yield                                              PROB: 4.724314e-31

### (Optional) Visualizing the Neural Network (See Step 4 of the Ipython notebook for more details)

The code in the cell 20 visualizes the output of two convolution layers of the above images. It is noticed that first layers of the network is able to represent wholesome features of the image and the deeper layers are able to represent each individual aspect of the image (like each edges of a triangle is identified by a neuron)

